<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Continuous Integration for the Coq Proof Assistant | Jason Gross</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="Continuous Integration for the Coq Proof Assistant" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Personal website of Jason Gross" />
<meta property="og:description" content="Personal website of Jason Gross" />
<link rel="canonical" href="http://localhost:4000/presentations/coq-workshop-2018-coq/dev/ci/" />
<meta property="og:url" content="http://localhost:4000/presentations/coq-workshop-2018-coq/dev/ci/" />
<meta property="og:site_name" content="Jason Gross" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Continuous Integration for the Coq Proof Assistant" />
<script type="application/ld+json">
{"@type":"WebPage","url":"http://localhost:4000/presentations/coq-workshop-2018-coq/dev/ci/","headline":"Continuous Integration for the Coq Proof Assistant","description":"Personal website of Jason Gross","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Jason Gross" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Jason Gross</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/">Jason Gross</a><a class="page-link" href="/papers/lob-paper/README-SUPPLEMENTAL.html">Lӧb’s Theorem: A functional pearl of dependently typed quining</a><a class="page-link" href="/papers/source/fiat-crypto/pldi-2017/rebuttal.html">General Clarifications</a><a class="page-link" href="/papers/source/fiat-crypto/popl-2018/reviews.html">POPL ‘18 Paper #2 Reviews and Comments</a><a class="page-link" href="/papers/source/lob-paper/README-SUPPLEMENTAL.html">Lӧb’s Theorem: A functional pearl of dependently typed quining</a><a class="page-link" href="/papers/source/rewriting/rewriting.html">Rewriter</a><a class="page-link" href="/presentations/coq-workshop-2018-coq/dev/doc/changes.html">Changes between Coq 8.7 and Coq 8.8</a><a class="page-link" href="/presentations/coq-workshop-2018-coq/dev/doc/debugging.html">Debugging from Coq toplevel using Caml trace mechanism</a><a class="page-link" href="/presentations/coq-workshop-2018-coq/dev/doc/econstr.html">Evar-insensitive terms (EConstr)</a><a class="page-link" href="/presentations/coq-workshop-2018-coq/dev/doc/proof-engine.html">Tutorial on the new proof engine for ML tactic writers</a><a class="page-link" href="/presentations/coq-workshop-2018-coq/dev/doc/xml-protocol.html">Coq XML Protocol</a><a class="page-link" href="/papers/lob-paper/">Lӧb’s Theorem: A functional pearl of dependently typed quining</a><a class="page-link" href="/papers/source/lob-paper/">Lӧb’s Theorem: A functional pearl of dependently typed quining</a><a class="page-link" href="/presentations/coq-8.6-wishlist/">coq-8.6-wishlist</a><a class="page-link" href="/presentations/coq-workshop-2018-coq/">Coq</a><a class="page-link" href="/presentations/coq-workshop-2018-coq/dev/ci/">Continuous Integration for the Coq Proof Assistant</a><a class="page-link" href="/presentations/coq-workshop-2018-coq/dev/ci/user-overlays/">Add overlays for your pull requests in this directory</a><a class="page-link" href="/presentations/coq-workshop-2018-coq/test-suite/">Coq Test Suite</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Continuous Integration for the Coq Proof Assistant</h1>
  </header>

  <div class="post-content">
    <h1 id="continuous-integration-for-the-coq-proof-assistant">Continuous Integration for the Coq Proof Assistant</h1>

<p>Changes to Coq are systematically tested for regression and compatibility
breakage on our Continuous Integration (CI) platforms <em>before</em> integration,
so as to ensure better robustness and catch problems as early as possible.
These tests include the compilation of several external libraries / plugins.</p>

<p>This document contains information for both external library / plugin authors,
who might be interested in having their development tested, and for Coq
developers / contributors, who must ensure that they don’t break these
external developments accidentally.</p>

<p><em>Remark:</em> the CI policy outlined in this document is susceptible to evolve and
specific accommodations are of course possible.</p>

<h2 id="information-for-external-library--plugin-authors">Information for external library / plugin authors</h2>

<p>You are encouraged to consider submitting your development for addition to
our CI. This means that:</p>

<ul>
  <li>Any time that a proposed change is breaking your development, Coq developers
will send you patches to adapt it or, at the very least, will work with you
to see how to adapt it.</li>
</ul>

<p>On the condition that:</p>

<ul>
  <li>
    <p>At the time of the submission, your development works with Coq master branch.</p>
  </li>
  <li>
    <p>Your development is publicly available in a git repository and we can easily
send patches to you (e.g. through pull / merge requests).</p>
  </li>
  <li>
    <p>You react in a timely manner to discuss / integrate those patches.</p>
  </li>
  <li>
    <p>You do not push, to the branches that we test, commits that haven’t been
first tested to compile with the corresponding branch(es) of Coq.</p>
  </li>
  <li>
    <p>Your development compiles in less than 35 minutes with just two threads.
If this is not the case, consider adding a “lite” target that compiles just
part of it.</p>
  </li>
</ul>

<p>In case you forget to comply with these last three conditions, we would reach
out to you and give you a 30-day grace period during which your development
would be moved into our “allow failure” category. At the end of the grace
period, in the absence of progress, the development would be removed from our
CI.</p>

<h3 id="add-your-development-by-submitting-a-pull-request">Add your development by submitting a pull request</h3>

<p>Add a new <code class="language-plaintext highlighter-rouge">ci-mydev.sh</code> script to <a href="/dev/ci"><code class="language-plaintext highlighter-rouge">dev/ci</code></a> (have a look at
<a href="/dev/ci/ci-coq-dpdgraph.sh"><code class="language-plaintext highlighter-rouge">ci-coq-dpdgraph.sh</code></a> or
<a href="/dev/ci/ci-fiat-parsers.sh"><code class="language-plaintext highlighter-rouge">ci-fiat-parsers.sh</code></a> for simple examples);
set the corresponding variables in
<a href="/dev/ci/ci-basic-overlay.sh"><code class="language-plaintext highlighter-rouge">ci-basic-overlay.sh</code></a>; add the corresponding
target to <a href="/Makefile.ci"><code class="language-plaintext highlighter-rouge">Makefile.ci</code></a>; add new jobs to
<a href="/.travis.yml"><code class="language-plaintext highlighter-rouge">.travis.yml</code></a> and <a href="/.gitlab-ci.yml"><code class="language-plaintext highlighter-rouge">.gitlab-ci.yml</code></a> so that
this new target is run. <strong>Do not hesitate to submit an incomplete pull request
if you need help to finish it.</strong></p>

<p>You may also be interested in having your development tested in our
performance benchmark. Currently this is done by providing an OPAM package
in https://github.com/coq/opam-coq-archive and opening an issue at
https://github.com/coq/coq-bench/issues.</p>

<h2 id="information-for-developers">Information for developers</h2>

<p>When you submit a pull request (PR) on Coq GitHub repository, this will
automatically launch a battery of CI tests. The PR will not be integrated
unless these tests pass.</p>

<p>Currently, we have two CI platforms:</p>

<ul>
  <li>
    <p>Travis is the main CI platform. It tests the compilation of Coq, of the
documentation, and of CoqIDE on Linux with several versions of OCaml /
camlp5, and with warnings as errors; it runs the test-suite and tests the
compilation of several external developments. It also tests the compilation
of Coq on OS X.</p>
  </li>
  <li>
    <p>AppVeyor is used to test the compilation of Coq and run the test-suite on
Windows.</p>
  </li>
</ul>

<p>You can anticipate the results of these tests prior to submitting your PR
by having them run of your fork of Coq, on GitHub or GitLab. This can be
especially helpful given that our Travis platform is often overloaded and
therefore there can be a significant delay before these tests are actually
run on your PR. To take advantage of this, simply create a Travis account
and link it to your GitHub account, or activate the pipelines on your GitLab
fork.</p>

<p>You can also run one CI target locally (using <code class="language-plaintext highlighter-rouge">make ci-somedev</code>).</p>

<p>Whenever your PR breaks tested developments, you should either adapt it
so that it doesn’t, or provide a branch fixing these developments (or at
least work with the author of the development / other Coq developers to
prepare these fixes). Then, add an overlay in
<a href="/dev/ci/user-overlays"><code class="language-plaintext highlighter-rouge">dev/ci/user-overlays</code></a> (see the README there)
in a separate commit in your PR.</p>

<p>The process to merge your PR is then to submit PRs to the external
development repositories, merge the latter first (if the fixes are
backward-compatible), drop the overlay commit and merge the PR on Coq then.</p>

<p>See also <a href="/test-suite/README.md"><code class="language-plaintext highlighter-rouge">test-suite/README.md</code></a> for information about adding new tests to the test-suite.</p>

<h2 id="travis-specific-information">Travis specific information</h2>

<p>Travis rebuilds all of Coq’s executables and stdlib for each job. Coq
is built with <code class="language-plaintext highlighter-rouge">./configure -local</code>, then used for the job’s test.</p>

<h2 id="gitlab-specific-information">GitLab specific information</h2>

<p>GitLab is set up to use the “build artifact” feature to avoid
rebuilding Coq. In one job, Coq is built with <code class="language-plaintext highlighter-rouge">./configure -prefix
install</code> and <code class="language-plaintext highlighter-rouge">make install</code> is run, then the <code class="language-plaintext highlighter-rouge">install</code> directory
persists to and is used by the next jobs.</p>

<p>Artifacts can also be downloaded from the GitLab repository.
Currently, available artifacts are:</p>
<ul>
  <li>the Coq executables and stdlib, in three copies varying in
architecture and Ocaml version used to build Coq.</li>
  <li>the Coq documentation, in two different copies varying in the OCaml
version used to build Coq</li>
</ul>

<p>As an exception to the above, jobs testing that compilation triggers
no Ocaml warnings build Coq in parallel with other tests.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Jason Gross</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jason Gross</li><li><a class="u-email" href="mailto:jgross@mit.edu">jgross@mit.edu</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/JasonGross"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">JasonGross</span></a></li><li><a href="https://www.twitter.com/diagram_chaser"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">diagram_chaser</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Personal website of Jason Gross</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
